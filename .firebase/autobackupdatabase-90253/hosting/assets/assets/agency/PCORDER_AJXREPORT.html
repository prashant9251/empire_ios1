<html>

<head>
    <title> JOBWORK REPORT </title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link href="4.1.1/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="1.10.4/jquery-ui.css" rel="stylesheet">
    <script src="1.10.2/jquery.js"></script>
    <script src="1.10.4/jquery-ui.js"></script>
    <script src="js/jsGetUrlParams.js"></script>
    <script>
        var url = window.location.href;
        REPORTTYPE = getUrlParams(url, "REPORTTYPE");

    </script>
</head>

<body class="loader-enabled">

    <div align="center" class="table-responsive">
        <table id="result" class="content-table">
        </table>
    </div>


    <div style="display: none;" id="loader">
        <div class="loader"></div>
        <div style="text-align: center; margin-top: -80px; font-weight:700">Please wait...</div>
    </div>

    <!-- The Modal -->


</body>

<script>
    var url = window.location.href;
    var DSN = getUrlParams(url, "DatabaseSource");
</script>
<script src="js/localStorageGet.js"></script>
<script src="js/jsLoadCallPCORDER.js"></script>
<script src="js/jsLoadCallPCORDER_SUMMERY.js"></script>
<script src="js/jsopenSubReport.js"></script>
<script src="js/jsGetYearChange.js"></script>
<script src="js/jsGetObjectByKey.js"></script>
<script src="js/jsfunction.js"></script>
<script src="js/jsGetDaysDif.js"></script>
<script src="js/jstoFixed.js"></script>
<script src="js/jsGetDateFormate.js"></script>
<script src="js/jsgetValueNotDefine.js"></script>
<script src="js/jsgetValueNotDefineNo.js"></script>
<script src="js/jstoFixedNumber.js"></script>
<script src="js/jsOpenBillDetilasAsTable.js"></script>


<script>
    var Data;
    var PAID = 'N';
    var ATYPE = '1';
    var tr = '';
    var FIRM = getUrlParams(url, "FIRM");

    var cno = '';
    var EMP;
    var partyname = getUrlParams(url, "partyname");
    var partycode = getUrlParams(url, "partycode");
    if (partyname == '') {
        partycode = '';
    }

    var qualname = getUrlParams(url, "qualname");
    var qualcode = getUrlParams(url, "qualcode");
    if (qualname == '') {
        qualcode = '';
    }
    var broker = getUrlParams(url, "broker");
    broker = broker == null ? "" : broker;
    var CITY = getUrlParams(url, "city");
    CITY = CITY == null ? "" : CITY;
    var haste = getUrlParams(url, "haste");
    var fromdate = getUrlParams(url, "search_FromDate");
    var todate = getUrlParams(url, "search_ToDate");
    var productDet = getUrlParams(url, "productDet");
    GRD = getUrlParams(url, "GRD");
    var CrntYearStartdate = getUrlParams(url, "CrntYearStartdate");
    var groupname = getUrlParams(url, "groupname");
    var doc_type = getUrlParams(url, "doc_type");
    var category = getUrlParams(url, "category");
    var ReportFilter = getUrlParams(url, "ReportFilter");
    
    var partynamegrp = getUrlParams(url, "partynamegrp");
    var partycodegrp = getUrlParams(url, "partycodegrp");
    var ccdgrp = getUrlParams(url, "ccdgrp");
    var ccdcodegrp = getUrlParams(url, "ccdcodegrp");

    var search_FromRecDate = getUrlParams(url, "search_FromRecDate");
    var search_ToRecDate = getUrlParams(url, "search_ToRecDate");

    var nowDate = new Date();
    document.title = "ORDER " + partyname + " " + broker + " " + CITY;
    $(document).ready(function () {
        $("#loader").addClass('has-loader');
        load_data();
    });
    var SERIES = [];
    var QUAL_LIST = [];
    function load_data() {
        jsGetObjectByKey(DSN, "COMPMST", "").then(function (data) {
            //console.log(data);
            DataCompmst = data;
            if (FIRM != '' && FIRM != null) {
                for (var i = 0; i < DataCompmst.length; i++) {
                    if (DataCompmst[i].FIRM == FIRM) {
                        cno = DataCompmst[i].CNO;
                    }
                }
            }
                    jsGetObjectByKey(DSN, "MST", "").then(function (data) {
                        masterData = data;
                        try { AddHeaderTbl(); } catch (error) { }
                        jsGetObjectByKey(DSN, "ORDER", "").then(function (data) {
                            Data = data;
                            if(ReportFilter=='PENDING' ){
                                Data = Data.filter(function (d) {
                                    return parseInt(d.PC || "0") >0 || parseFloat(d.PP || "0") <0;
                                });
                            }else if(ReportFilter=='COMPLETED' ){
                                Data = Data.filter(function (d) {
                                    return parseInt(d.PC || "0") ==0 && parseFloat(d.PP || "0") ==0;
                                });
                            }

                            if (partycode != '' && partycode != null) {
                                Data = Data.filter(function (d) {
                                    return d.CC == partycode;
                                });
                            }
                            if(partycodegrp != '' && partycodegrp != null){
                                Data = Data.filter(function (d) {
                                    return d.C == partycodegrp;
                                });
                            }
                            if(ccdcodegrp != '' && ccdcodegrp != null){
                                Data = Data.filter(function (d) {
                                    return d.S == ccdcodegrp;
                                });
                            }
                            if (search_FromRecDate !== '' && search_FromRecDate !== null) {
                                Data = Data.filter(function (d) {
                                    return new Date(d.D).setHours(0, 0, 0, 0) >= new Date(search_FromRecDate).setHours(0, 0, 0, 0);
                                });
                            }
                            if (search_ToRecDate !== '' && search_ToRecDate !== null) {
                                Data = Data.filter(function (d) {
                                    return new Date(d.D).setHours(24, 24, 0, 0) <= new Date(search_ToRecDate).setHours(24, 0, 0, 0);
                                });
                            }
                            loadCall(Data);
                        });
                    });
                });
    }

    function getQualData(qualCode) {
        return QUAL_LIST.filter(function (d) {
            return d.value == qualCode;
        })
    }

</script>
<script src="js/jsHeaderTbl.js"></script>