<html>

<head>
  <title> OUTSTANDING </title>
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link href="4.1.1/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <link href="1.10.4/jquery-ui.css" rel="stylesheet">
  <script src="1.10.2/jquery.js"></script>
  <script src="1.10.4/jquery-ui.js"></script>
  <script src="js/jsGetUrlParams.js"></script>
  <script>
    var url = window.location.href;
    REPORTTYPE = getUrlParams(url, "REPORTTYPE");
    var FIRM = getUrlParams(url, "FIRM");


  </script>
</head>
<Style>

</Style>

<body>
  <div align="center" class="table-responsive">
    <table id="result" style="width: 95%;" class="content-table">
    </table>
  </div>


  <div style="display: none;" id="loader">
    <div class="loader"></div>
    <div style="text-align: center; margin-top: -80px; font-weight:700">Please wait...</div>
  </div>

  <div class="footer pdfBtnHide" id="footer" style="display: none;width: 100%;">
    <div style="width: 50%;display:inline;float: left;">
        <button class="btn btn-lg btn-block" style="background-color: #f08827;color: white;"
            onclick="filterSelected();">Load Selected</button>
    </div>
    <div style="width: 50%;display:inline;float: left;">
        <button class="btn btn-lg btn-block" onclick="filterSelectedBulkPdfBill();"
            style="background-color:#284a7a;color: white;">BULK PDF BILL</button>
    </div>
  </div>
</body>

</html>
<script>
  // var url = window.location.href;
  // var DSN = getUrlParams(url, "DatabaseSource");

  var TransectionArray = [];
  var BrokerNameList = [];
  var PartyNameList = [];

  var GRD;
  var MonthList = [];
  var PartynameList = []; 
</script>
<script src="js/localStorageGet.js"></script>
<script src="js/jsLoadCallTDS.js"></script>
<script src="js/jsGetObjectByKey.js"></script>
<script src="js/jsopenSubReport.js"></script>
<script src="js/jsGetUrlParams.js"></script>
<script src="js/jsGetYearChange.js"></script>
<script src="js/jsGetDaysDif.js"></script>
<script src="js/jsgetArrayProductdetailsbyIDE.js"></script>
<script src="js/jsGetDateFormate.js"></script>
<script src="js/jstoFixed.js"></script>
<script src="js/jstoFixedNumber.js"></script>
<script src="js/jsfunction.js"></script>
<script src="js/filterSelected.js"></script>
<script src="js/jsgetValueNotDefine.js"></script>
<script>

  var pdfStatus = false;
  var Data;
  var PAID = 'N';
  var ATYPE = '1';
  var tr = '';
  var cno = '';
  var EMP;
  var partyname = getUrlParams(url, "partyname");
  var partycode = getUrlParams(url, "partycode");
  if (partyname == '') {
    partycode = '';
  }
  var MARKET = getUrlParams(url, "MARKET");
  var broker = getUrlParams(url, "broker");
  var CITY = getUrlParams(url, "city");
  var haste = getUrlParams(url, "haste");
  var fromdate = getUrlParams(url, "search_FromDate");
  var todate = getUrlParams(url, "search_ToDate");
  var DAYSCONDITION = getUrlParams(url, "DAYSCONDITION");
  var groupname = getUrlParams(url, "groupname");
  var productDet = getUrlParams(url, "productDet");
  GRD = getUrlParams(url, "GRD");
  var nowDate = new Date();

  var ReportType = getUrlParams(url, "ReportType");
  var ReportSeriesTypeCode = getUrlParams(url, "ReportSeriesTypeCode");
  var ReportATypeCode = getUrlParams(url, "ReportATypeCode");
  var ReportDOC_TYPECode = getUrlParams(url, "ReportDOC_TYPECode");
  var chqFilterOnDate = getUrlParams(url, "chqFilterOnDate");
  var months = getUrlParams(url, "months");
  
  //console.log(ReportType, ReportSeriesTypeCode, ReportATypeCode, ReportDOC_TYPECode);

</script>
<script>
  document.title = "OUTSTANDING " + partyname + " " + broker + " " + CITY;
  $(document).ready(function () {
    $("#loader").addClass('has-loader');
    load_data();
  });
  var SERIES = [];
  function load_data() {
    jsGetObjectByKey(DSN, "COMPMST", "").then(function (data) {
      //console.log(data);
      DataCompmst = data;
      if (FIRM != '' && FIRM !=null) {
          for (var i = 0; i < DataCompmst.length; i++) {
              if (DataCompmst[i].FIRM == FIRM) {
                  cno = DataCompmst[i].CNO;
              }
          }
      }
    jsGetObjectByKey(DSN, "ATYPE", "").then(function (ATYPE_ARR) {
      this.ATYPE_ARR = ATYPE_ARR;
      //console.log(ATYPE_ARR);
      jsGetObjectByKey(DSN, "SERIES", "").then(function (SERIES) {
        this.SERIES = SERIES;
      jsGetObjectByKey(DSN, "MST", "").then(function (data) {
        masterData = data;
        AddHeaderTbl();
        try {
        } catch (error) { }
        jsGetObjectByKey(DSN, "TDS", "").then(function (data) {
          Data = data;

          Data = Data.filter(function (data) {
            return data.billDetails.some((billDetails) => parseInt(billDetails['TA']) >0);
          }).map(function (subdata) {
            return {
              code: subdata.code,
              billDetails: subdata.billDetails.filter(function (billDetails) {
                return (parseInt(billDetails['TA']) >0);
              })
            }
          })
          if (cno != '' && cno != null) {
            Data = Data.filter(function (data) {
              return data.billDetails.some((billDetails) => billDetails['CNO'] == cno);
            }).map(function (subdata) {
              return {
                code: subdata.code,
                billDetails: subdata.billDetails.filter(function (billDetails) {
                  return (billDetails['CNO'] == cno);
                })
              }
            })
          }

          if (partycode != '' && partycode != null) {
            partycode = partycode.trim();
            Data = Data.filter(function (data) {
              return data['code'] == partycode;
            })
          }
        // //console.log("BLS", Data);
       

        if(months!=null && months !=""){
          Data = Data.filter(function (data) {
            return data.billDetails.some((billDetails) => parseInt(new Date(DateRpl(billDetails.DT)).getMonth()+1) === parseInt(months));
          }).map(function (subdata) {
              return {
                  code: subdata.code,
                  billDetails: subdata.billDetails.filter(function (billDetails) {
                      return parseInt(new Date(DateRpl(billDetails.DT)).getMonth()+1) === parseInt(months);
                  })
              }
          })
        };
          loadCall(Data);          
        });
      })
    })
    })
    })
  }



  function getSeriesDetialsName(TYPE) {
    var RetVal = "";
    var newSeries = SERIES.filter(function (d) {
      return d.SERIESCODE == TYPE;
    })
    if (newSeries.length > 0) {
      RetVal = newSeries[0].SERIES;
    }
    return RetVal;
  }

</script>

<script src="js/jsHeaderTbl.js"></script>