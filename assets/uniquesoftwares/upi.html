<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="2.1.3/jquery.min.js"></script>
    <script src="3.3.6/bootstrap.min.js"></script>
    <link href="3.3.6/bootstrap.min.css" rel="stylesheet" />
    <script src="js/jsGetUrlParams.js"></script>


</head>
<style>
    .solidp {
        border-style: solid;
        border-color: #000000;
        border-width: 1px;
    }
</style>

<script>
    var url = window.location.href;
    var MCNO = getUrlParams(url, "MCNO");
    var MTYPE = getUrlParams(url, "MTYPE");
    var DSN = getUrlParams(url, "DatabaseSource");
    var Currentyear = getUrlParams(url, "Currentyear");
    var login_user = getUrlParams(url, "login_user");
        //alert(DSN);

</script>
<script src="js/localStorageGet.js"></script>
<script src="js/jsGetObjectByKey.js"></script>
<script src="js/jsStoreDatatoIndexeddb.js"></script>
<script src="js/jsPopUpTblSetting.js"></script>
<script src="js/jsoptionSeriesSelect.js"></script>
<script src="js/jsoptionFirmSelect.js"></script>
<script src="js/jsSearchfrm.js"></script>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link href="4.1.1/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<link href="1.10.4/jquery-ui.css" rel="stylesheet">
<script src="1.10.4/jquery-ui.js"></script>
<link rel="stylesheet" href="css/stylePrint.css">
<link rel="stylesheet" href="css/styleAutoComplete.css">
<title>Upi</title>
</head>

<body>
    <div class="container" style="width: 100%;">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <header class="card-header">
                        <h2 class="card-title mt-2">Create Upi Payment page(Only Admin can Save changes)</h2>
                    </header>
                    <article class="card-body">
                        <!-- <form>                             -->
                        <div class="form-row" style="text-align: center;">
                            <div class="col form-group">
                                <img src="./../upi.webp" height="200px" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col form-group">
                                <h3>FIRM</h3>
                                <select class="form-control inputText" onchange="changeUpidata()" style="height: 40px;"
                                    id="FIRM" name="FIRM">
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col form-group">
                                <h3>UPI ID</h3>
                                <input class="form-control inputText" autocomplete="off" value="" disabled
                                    placeholder="Please enter upi Id" name="upiId" id="upiId">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col form-group">
                                <h3>Contact</h3>
                                <input class="form-control inputText" autocomplete="off" value="" disabled
                                    placeholder="Contact No." name="upiContact" id="upiContact">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col form-group">
                                <h3>UPI NAME</h3>
                                <input class="form-control inputText" autocomplete="off" value="" disabled
                                    placeholder="UPI NAME" name="upiName" id="upiName">
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="submit" name="submit" onclick="validate();"
                                class="btn btn-primary btn-lg btn-block inputText" value="save" id="save" disabled>
                        </div>
                        <div class="form-row">
                            <div class="col form-group">
                                <input type="submit" name="submit" onclick="viewUpiPage();"
                                    class="btn btn-primary btn-lg btn-block inputText" value=" View payment page"
                                    id="viewPage">
                            </div>
                            <div class="col form-group">
                                <input type="submit" name="submit" onclick="example();"
                                    class="btn btn-primary btn-lg btn-block inputText" value="Example in PDF"
                                    id="viewPage">

                            </div>

                        </div>
                        <div class="form-group">

                        </div>


                        <div class="form-group">
                        </div>
                        <h1> <code>Note</code></h1>
                        <p class="solidp">
                        <h3>aap yaha se payment page bana sakte h.
                            jab aap party ko pdf bhejenge tab pdf me (Pay as Upi ) button show hoga
                            uspe click karke client apko <code>(Upi app ke through)</code> payment kar sakte hai.</h3>
                        <h5 style="color: red;">Aap jis bhi client ko (Sale Outstanding pdf) bhejenge unke mobile me upi
                            App hona
                            Compulsory hai. <br>

                            tabhi upi ke through payment kar sakte hai.</h5>
                        </p>
                        <h1 style="color: blue;"> Terms of use
                            <br><code>we are not responsible for  any kind of payment transaction </code>
                        </h1>


                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                </div>
            </div>

            <!-- </form> -->
        </div>
    </div>

</body>
<script>
    var userUpi;
    var currentUser={};
    $(document).ready(function () {
        SelectFirmOptions("FIRM");
        if (login_user != null) {
            //console.log(login_user);
            if (login_user.toUpperCase().indexOf("ADMIN") > -1 || login_user.toUpperCase().indexOf("PRASHANT3009") > -1) {
                $("#save").prop('disabled', false);
                $("#upiId").prop('disabled', false);
                $("#upiContact").prop('disabled', false);
                $("#upiName").prop('disabled', false);
            }
        }
        getCurrentUser().then(function(d){
            currentUser = d;
            try {
                userUpi = currentUser["upi"];
                setTimeout(changeUpidata, 1000);
            } catch (err) {
                setTimeout(changeUpidata, 1000);
            }
        })

    });
    function validate() {
        var FIRM = $("#FIRM").val();
        var upiId = $("#upiId").val();
        var upiContact = $("#upiContact").val();
        var upiName = $("#upiName").val();
        getCurrentUser().then(function(d){
             currentUser = d;
            if (currentUser != null) {
                currentUser.upiId = upiId;
                currentUser.FIRM = FIRM;
                currentUser.upiContact = upiContact;
                currentUser.upiShopName = FIRM;
                currentUser.upiName = upiName;
                saveProcess();
            }
        })
        

    }

    function saveProcess() {
        var url = "https://aashaimpex.com/LOGINIOS/upiUpdate.php";
        var req = new XMLHttpRequest();
        req.open("POST", url, true);
        req.onload = function (event) {
            var d = (req.response);
            if (d != null) {
                alert("Saved successfully");
                alert("Please restart app")
            }
        }
        req.send(JSON.stringify(currentUser));
    }

    function changeUpidata() {
        var FIRM = $("#FIRM").val();
        var upiObj = JSON.parse(userUpi);
        upiArr = upiObj[FIRM];
        $("#upiId").val(upiArr["upi"]);
        $("#upiContact").val(upiArr["contact"]);
        $("#upiName").val(upiArr["upiName"]);
    }
    function viewUpiPage() {
        var FIRM = $("#FIRM").val();
        var upiObj = JSON.parse(userUpi);
        upiArr = upiObj[FIRM];
        var upiContact = upiArr["contact"];
        var upiShopName = upiArr["upiShopName"];
        var upiAddress = upiArr["upi"];
        var upiName = upiArr["upiName"];
        var upiId = upiAddress;
        var nurl = "https://uniqsoftwares.com/upi/paynow.php?ntab=NTABcontact=" + upiContact + "&shopName=" + encodeURIComponent(upiShopName) + "&upiId=" + encodeURIComponent(upiId) + "&upiName=" + encodeURIComponent(upiName) + "&upi=" + encodeURIComponent(upiAddress);
        window.open(nurl);
    }

    function example() {
        window.open("upidemoViewUpi.html?ntab=NTAB");
    }
</script>

</html>